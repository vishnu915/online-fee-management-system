{% extends "base.html" %}
{% block content %}
<h2>Make Payment for {{ fee_type.title() }} Fee</h2>
<form method="POST" class="card" style="max-width:400px;">
    <label>Admission No.</label>
    <input type="text" name="admission_no" value="{{ student.admission_no }}" readonly>
    <label>Student Name</label>
    <input type="text" name="student_name" value="{{ student.name }}" readonly>
    <label>Bill Number</label>
    <input type="text" name="bill_no" placeholder="Enter Bill Number" required>
    <label>Fee Amount</label>
    <input type="number" name="fee_amount" value="{{ fee[fee_type+'_fee'] }}" readonly>
    <label>Discount</label>
    <input type="number" name="discount" value="{{ discount if discount is defined else 0 }}" min="0" max="{{ fee[fee_type+'_fee'] }}" required>
    <label>Paid Amount</label>
    <input type="number" name="paid_amount" value="{{ paid_amount if paid_amount is defined else '' }}" step="0.01" min="0" required>
    <label>Remaining Balance</label>
    {% set net_amount = fee[fee_type+'_fee']|float - (discount|float if discount is defined else 0.0) %}
    {% set remaining_balance = net_amount - (paid_amount|float if paid_amount is defined else 0.0) %}
    <input type="number" name="remaining_balance" value="{{ remaining_balance }}" readonly>
    <label>Date</label>
    <input type="date" name="payment_date" required>
    <input type="submit" value="Pay" class="btn">
    <a href="{{ url_for('fee_payment') }}" class="btn">Cancel</a>
</form>
<script>
    // Dynamic calculation of remaining balance
    const feeAmountInput = document.querySelector('input[name="fee_amount"]');
    const discountInput = document.querySelector('input[name="discount"]');
    const paidAmountInput = document.querySelector('input[name="paid_amount"]');
    const remainingInput = document.querySelector('input[name="remaining_balance"]');

    function updateRemaining() {
        const feeAmount = parseFloat(feeAmountInput.value) || 0;
        const discount = parseFloat(discountInput.value) || 0;
        const paidAmount = parseFloat(paidAmountInput.value) || 0;
        const net = feeAmount - discount;
        const remaining = net - paidAmount;
        remainingInput.value = remaining >= 0 ? remaining.toFixed(2) : 0;
    }

    discountInput.addEventListener('input', updateRemaining);
    paidAmountInput.addEventListener('input', updateRemaining);
    window.addEventListener('DOMContentLoaded', updateRemaining);
</script>
{% endblock %}